function sticky_relocate(){var t=$(window).scrollTop();if($(".xshop-designer-tool-topbar").length>0){var e=$(".xshop-designer-tool-topbar").offset().top;t>5?$(".xshop-designer-tool-topbar").addClass("xshop-designer-top-bar-stick"):$(".xshop-designer-tool-topbar").removeClass("xshop-designer-top-bar-stick")}}jQuery.widget("ui.xepan_xshopdesigner",{pages_and_layouts:{"Front Page":{"Main Layout":{components:[],background:void 0}}},layout_finalized:{"Front Page":"Main Layout"},current_selected_component:void 0,current_page:"Front Page",current_layout:"Main Layout",item_member_design_id:void 0,workplace:void 0,canvas:void 0,canvasObj:void 0,safe_zone:void 0,cart:void 0,zoom:1,delta_zoom:0,px_width:void 0,option_panel:void 0,freelancer_panel:void 0,editors:[],top_bar:void 0,pointtopixel:{6:8,7:9,8:11,9:12,10:13,11:15,12:16,13:17,14:19,15:21,16:22,17:23,18:24,19:25,20:26,21:28,22:29,23:31,24:32,25:33,26:35,27:36,28:37,29:38,30:40,31:41,32:42,33:44,34:45,35:47,36:48},options:{showTopBar:!0,IncludeJS:["FreeLancerPanel"],ComponentsIncluded:["BackgroundImage","Text","Image","PDF","ZoomPlus","ZoomMinus","Save","Calendar"],design:[],show_cart:!1,cart_options:[],designer_mode:!1,width:void 0,height:void 0,selected_layouts_for_print:{},calendar_starting_month:void 0,calendar_starting_year:void 0,calendar_event:{},base_url:void 0,watermark_text:"xepan"},_create:function(){this.setupLayout()},setupLayout:function(){var t=this;$.each(this.options.IncludeJS,function(e,o){$.atk4.includeJS(t.options.base_url+"vendor/xepan/commerce/templates/js/tool/designer/plugins/"+o+".js")}),$.each(this.options.ComponentsIncluded,function(e,o){$.atk4.includeJS(t.options.base_url+"vendor/xepan/commerce/templates/js/tool/designer/plugins/"+o+".js")}),$.atk4.includeJS(t.options.base_url+"vendor/xepan/commerce/templates/js/tool/designer/plugins/PageLayout.js"),$.atk4(function(){t.setupWorkplace(),window.setTimeout(function(){t.setupCanvas(),t.options.showTopBar&&t.setupToolBar(),t.loadDesign(),t.setupPageLayoutBar(),t.setupFreelancerPanel(),t.render()},200)})},loadDesign:function(){var t=this;if(""==t.options.design||!t.options.design||"null"==t.options.design){var e=new BackgroundImage_Component;return e.init(t,t.canvas,null),void(t.pages_and_layouts[t.current_page][t.current_layout].background=e)}saved_design=JSON.parse(t.options.design),$.each(saved_design,function(e,o){t.pages_and_layouts[e]={},t.layout_finalized[e]="Main Layout",$.each(o,function(o,i){t.pages_and_layouts[e][o]={},t.pages_and_layouts[e][o].components=[],void 0!=i.components&&0!=i.components.length&&$.each(i.components,function(i,n){n=JSON.parse(n);var s=new window[n.type+"_Component"];s.init(t,t.canvas,t.editors[n.type]),s.options=n,s.options.load_design=!0,t.pages_and_layouts[e][o].components[i]=s});var n=new BackgroundImage_Component;n.init(t,t.canvas,null),void 0!=i.background&&(n.options=JSON.parse(i.background)),t.pages_and_layouts[e][o].background=n})}),""!=t.options.selected_layouts_for_print&&t.options.selected_layouts_for_print&&null!=t.options.selected_layouts_for_print&&void 0!=t.options.selected_layouts_for_print&&$.each(t.options.selected_layouts_for_print,function(e,o){t.layout_finalized[e]=o})},setupPageLayoutBar:function(){var t=this,e=$('<div class="xshop-designer-tool-bottombar"></div>');e.appendTo(this.element),t.bottombar_wrapper=e;var o=new PageLayout_Component;o.init(t,t.canvas,e),bottom_tool_btn=o.renderTool(),t.bottom_bar=o},setupToolBar:function(){var t=this;this.top_bar=$('<div class="xshop-designer-tool-topbar row"></div>'),this.top_bar.prependTo(this.element);var e=$('<h1 class="xshop-designer-item-name">'+t.options.item_name+"</h1>");e.prependTo(this.top_bar.parent());var o=$('<div class="xshop-designer-tool-topbar-buttonset"></div>').appendTo(this.top_bar);this.option_panel=$('<div class="xshop-designer-tool-topbar-options pull-right" style="display:none;"></div>').appendTo(this.top_bar),$.each(this.options.ComponentsIncluded,function(e,o){var i=new window[o+"_Component"];i.init(t,t.canvas),tool_btn=i.renderTool(t.top_bar),t.editors[o]=i.editor}),$(this.canvas).click(function(e){$(".ui-selected").removeClass("ui-selected"),t.option_panel.hide(),t.current_selected_component=void 0,t.options.designer_mode&&t.freelancer_panel.FreeLancerComponentOptions.element.hide(),$("div.guidex").css("display","none"),$("div.guidey").css("display","none"),e.stopPropagation()})},setupFreelancerPanel:function(){var t=this;this.options.designer_mode&&(this.freelancer_panel=new FreeLancerPanel(this.top_bar,t,t.canvas),this.freelancer_panel.init())},setupWorkplace:function(){this.workplace=$('<div class="xshop-designer-tool-workplace" style="width:100%"></div>').appendTo(this.element)},setupComponentPanel:function(t){this.component_panel=$('<div id="xshop-designer-component-panel" class=" col-md-3">Nothing Selecetd</div>').appendTo(t)},setupCanvas:function(){var t=this;this.canvas=$('<div class="xshop-desiner-tool-canvas atk-move-center" style="position:relative; z-index:0;"><canvas id="xshop-desiner-tool-canvas"></canvas></div>').appendTo(this.workplace),this.canvasObj=new fabric.Canvas("xshop-desiner-tool-canvas"),this.canvas.css("width",this.options.width+this.options.unit),this.px_width=this.canvas.width(),this.canvas.css("overflow","hidden"),this.canvas.width()>this.workplace.width()&&this.canvas.css("width",this.workplace.width()-20+"px"),this.canvas.width()<this.workplace.width()/2&&this.canvas.width(this.workplace.width()/2),this.safe_zone=$('<div class="xshop-desiner-tool-safe-zone" style="position:absolute"></div>').appendTo(this.canvas),this.guidex=$('<div class="guidex" style="z-index:100;"></div>').appendTo($("body")),this.guidey=$('<div class="guidey" style="z-index:100;"></div>').appendTo($("body"))},setupCart:function(){var t=this;t.options.show_cart&&(t.options.designer_mode||(t.options.cart_options.show_cart_btn=!0,t.options.cart_options.base_url=t.options.base_url,cart_container=$('<div class="xepan-xshop-designer-cart-container"></div>').appendTo(t.element),price_div=$('<div class="xshop-item-price"></div>').appendTo(cart_container),original_rate=$('<div class="xshop-item-old-price">'+t.options.currency_symbole+" "+t.options.item_original_price+"</div>").appendTo(price_div),price_rate=$('<div class="xshop-item-new-price">'+t.options.currency_symbole+" "+t.options.item_sale_price+"</div>").appendTo(price_div),this.cart=$('<div class="xshop-designer-item-custom-field-container"></div>').appendTo(cart_container),this.cart.xepan_xshop_addtocart(t.options.cart_options),cart_container.hide()))},render:function(t){var e=this;this.canvas.css("height",this.options.height+this.options.unit),this.canvas.height(this.canvas.height()*this._getZoom()),this.safe_zone.css("width",this.options.width-2*this.options.trim+this.options.unit),this.safe_zone.css("height",this.options.height-2*this.options.trim+this.options.unit),this.safe_zone.width(this.safe_zone.width()*this._getZoom()),this.safe_zone.height(this.safe_zone.height()*this._getZoom());var o=(this.canvas.width()-this.safe_zone.width())/2;return this.safe_zone.css("margin-left",o),this.safe_zone.css("margin-right",o),this.safe_zone.css("margin-top",o),this.safe_zone.css("margin-bottom",o),void this.canvas.find(".xshop-designer-component").hide();void 0!=e.pages_and_layouts[e.current_page][e.current_layout].components&&0!=e.pages_and_layouts[e.current_page][e.current_layout].components.length&&$.each(e.pages_and_layouts[e.current_page][e.current_layout].components,function(t,e){e.render()}),void 0!=e.pages_and_layouts[e.current_page][e.current_layout].background&&0!=e.pages_and_layouts[e.current_page][e.current_layout].background.length&&e.pages_and_layouts[e.current_page][e.current_layout].background.render()},_getZoom:function(){var t=this.canvas.width()/this.px_width;return t!=this.zoom&&(this.delta_zoom=this.zoom+t,this.zoom=t),this.zoom},_isDesignerMode:function(){return this.options.designer_mode},get_widget:function(){return this},check:function(){},screen2option:function(t){return t/this._getZoom()},option2screen:function(t){return t*this._getZoom()}}),function($){$.fn.delayKeyup=function(t,e){return $(this).keyup(function(o){var i=o.currentTarget;i.delayTimer&&clearTimeout(i.delayTimer),i.delayTimer=setTimeout(function(){t($(i))},e)}),$(this)}}(jQuery),$.ui.plugin.add("draggable","smartguides",{start:function(t,e){var i=$(this).data("ui-draggable");o=i.options,i.elements=[],$(o.smartguides.constructor!=String?o.smartguides.items||":data(ui-draggable)":o.smartguides).each(function(){var t=$(this),e=t.offset();this!=i.element[0]&&i.elements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:e.top,left:e.left})})},drag:function(t,e){var o=$(this).data("ui-draggable"),i=o.options,n=i.tolerance;$(".guidex").css({display:"none"}),$(".guidey").css({display:"none"});var s=e.offset.left,a=s+o.helperProportions.width,r=e.offset.top,p=r+o.helperProportions.height;xc=(s+a)/2,yc=(r+p)/2;for(var d=o.elements.length-1;d>=0;d--){var c=o.elements[d].left,l=c+o.elements[d].width,h=o.elements[d].top,u=h+o.elements[d].height;hc=(c+l)/2,vc=(h+u)/2;var _=Math.abs(c-a)<=n,g=Math.abs(c-s)<=n,v=Math.abs(l-s)<=n,m=Math.abs(h-p)<=n,f=Math.abs(u-r)<=n,y=Math.abs(hc-xc)<=n,b=Math.abs(vc-yc)<=n,w=Math.abs(l-a)<=n;g&&(e.position.left=o._convertPositionTo("relative",{top:0,left:c}).left-o.margins.left,$(".guidex").css({left:c-n+4,display:"block"})),_&&(e.position.left=o._convertPositionTo("relative",{top:0,left:c-o.helperProportions.width}).left-o.margins.left,$(".guidex").css({left:c-n+4,display:"block"})),v&&(e.position.left=o._convertPositionTo("relative",{top:0,left:l}).left-o.margins.left,$(".guidex").css({left:l-n+4,display:"block"})),m&&(e.position.top=o._convertPositionTo("relative",{top:h-o.helperProportions.height,left:0}).top-o.margins.top,$(".guidey").css({top:h-n+4,display:"block"})),f&&(e.position.top=o._convertPositionTo("relative",{top:u,left:0}).top-o.margins.top,$(".guidey").css({top:u-n+4,display:"block"})),w&&(e.position.left=o._convertPositionTo("relative",{top:0,left:l-o.helperProportions.width}).left-o.margins.left,$(".guidex").css({left:l-n+4,display:"block"})),y&&(e.position.left=o._convertPositionTo("relative",{top:0,left:hc-o.helperProportions.width/2}).left-o.margins.left,$(".guidex").css({left:hc-n+4,display:"block"})),b&&(e.position.top=o._convertPositionTo("relative",{top:vc-o.helperProportions.height/2,left:0}).top-o.margins.top,$(".guidey").css({top:vc-n+8,display:"block"}))}},stop:function(t,e){$(".guidex").hide(),$(".guidey").hide()}});